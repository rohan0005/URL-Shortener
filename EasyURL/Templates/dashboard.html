<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My URLs Dashboard</title>

  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-indigo-50 min-h-screen">

  <!-- nav bar -->
  <nav class="w-full bg-white shadow-sm">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold text-indigo-700">EasyURL</h1>

      <!-- profile -->
      <div class="w-9 h-9 rounded-full bg-indigo-100 flex items-center justify-center cursor-pointer hover:bg-indigo-200">
        üë§
      </div>
    </div>
  </nav>

  <!-- Dashboard -->
  <main class="max-w-6xl mx-auto px-6 py-10">

    <h2 class="text-2xl font-bold text-slate-900 mb-6">
      My Shortened URLs
    </h2>

    <!--Error or Success Messages -->
    {% if messages %}
    {% for message in messages %}
    <div class="mb-4 p-4 rounded-lg flex items-center justify-between
                {% if message.tags == 'success' %}bg-green-100 text-green-800
                {% elif message.tags == 'error' %}bg-red-100 text-red-800
                {% else %}bg-blue-100 text-blue-800{% endif %}">
      <span>{{ message }}</span>
      <button onclick="this.parentElement.remove()" class="text-lg">&times;</button>
    </div>
    {% endfor %}
    {% endif %}

    <!-- Table -->
    <div class="overflow-x-auto bg-white rounded-xl shadow-sm">
      <table class="min-w-full border-collapse">
        <thead class="bg-indigo-50">
          <tr>
            <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">Short URL</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">Original URL</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-slate-700">Created</th>
            <th class="px-4 py-3 text-center text-sm font-semibold text-slate-700">Actions</th>
          </tr>
        </thead>

        <tbody>
            {% if URLDetails %} 
            {% for url in URLDetails %}
          <!-- Row -->
          <tr class="border-t">


            <td class="px-4 py-3 text-indigo-600 font-semibold">
              
                <!--without edit-->
              <div id="view-{{ url.short_key }}">
                <a href="{{ url.short_url }}" target="_blank" class="hover:underline">
                  {{ url.short_url }}
                </a>
              </div>

              <!--if user clicks edit button-->
                <form id="edit-{{ url.short_key }}" class="hidden" method="POST" action="{% url 'edit-url' url.short_key %}">
                {% csrf_token %}
                 <div class="flex items-center gap-1">
                  <span class="text-gray-500 text-sm">{{ request.scheme }}://{{ request.get_host }}/</span>
                  <input type="text" name="new_short_key" value="{{ url.short_key }}"
                         id="input-{{ url.short_key }}"
                         class="w-24 px-2 py-1 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none text-sm"
                         pattern="[a-zA-Z0-9]+" 
                         title="Only letters and numbers allowed"
                         required>
                </div>
                 <!-- for error short key -->
                <p id="error-{{ url.short_key }}" class="text-red-500 text-xs mt-1 hidden"></p>
              </form>

            </td>


            <td class="px-4 py-3 text-slate-600 truncate max-w-xs">
              {{ url.original_url }}
            </td>
            <td class="px-4 py-3 text-slate-600">
              {{ url.created_date|date:"M d, Y H:i" }}
            </td>
            <!-- 
            <td class="px-4 py-3 text-slate-600">
              {{ url.expiry_date|date:"M d, Y H:i" }}
            </td>
           <td class="px-4 py-3 text-slate-600">
                {% if url.clicks == 0 %}
                    No clicks yet
                {% else %}
                    {{ url.clicks }}
                {% endif %}
            </td>-->
            <td class="px-4 py-3 text-center space-x-2">

              <button id="edit-btn-{{ url.short_key }}" 
                      onclick="enableEdit('{{ url.short_key }}')"
                      class="px-3 py-1 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                Edit
              </button>
             <!--  Save Button hidden -->
              <button id="save-btn-{{ url.short_key }}" 
                      onclick="saveEdit('{{ url.short_key }}')"
                      class="hidden px-3 py-1 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700">
                Save
              </button>
              
              <!-- Cancel Button hidden -->
              <button id="cancel-btn-{{ url.short_key }}" 
                      onclick="cancelEdit('{{ url.short_key }}', '{{ url.original_url }}')"
                      class="hidden px-3 py-1 text-sm bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                Cancel
              </button>
              
              <!-- Delete Button -->
              <button onclick="openDeleteModal('{{ url.short_key }}', '{{ url.short_url }}')"
              class="px-3 py-1 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600">
                Delete
              </button>

              <!-- QR Button -->
              <button onclick="showQR('{% url 'qr-code' url.short_key %}', '{{ url.short_key }}')"
                      class="px-3 py-1 text-sm bg-black text-white rounded-lg hover:bg-gray-800">
                QR
              </button>
                <!-- Stats Button -->
               <button onclick="showStats('{{ url.clicks }}',
                                        '{% if url.expiry_date %}{{ url.expiry_date|date:"M d, Y H:i" }}{% else %}Never Expires{% endif %}',
                                        '{% if url.is_expired %}True{% else %}False{% endif %}')"
                      class="px-3 py-1 text-sm bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                Stats
              </button>
            </td>
          </tr>
          {% endfor %}

          {% else %}


          <tr>
            <td colspan="5" class="px-4 py-8 text-center text-slate-500">
              No URLs created yet.
            </td>
          </tr>

          {% endif %}
          

        </tbody>
      </table>
    </div>

    
  <!--  delete conform modal -->
  <div id="delete-modal" class="hidden fixed inset-0 z-50">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black bg-opacity-50" onclick="closeDeleteModal()"></div>
    
    <!-- Modal Content -->
    <div class="fixed inset-0 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm">
        
        <!-- Body -->
        <div class="p-6 text-center">
          <!-- Warning Icon -->
          <div class="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
            <span class="text-3xl">üóëÔ∏è</span>
          </div>
          
          <h3 class="text-xl font-bold text-slate-900 mb-2">Delete URL?</h3>
          <p class="text-gray-500 mb-2">This action cannot be undone!</p>
          <p id="delete-url-display" class="text-indigo-600 font-semibold text-sm mb-6 break-all"></p>
          
          <!-- Buttons -->
          <form id="delete-form" method="POST" action="">
            {% csrf_token %}
            <div class="flex gap-3">
              <button type="button" onclick="closeDeleteModal()"
                      class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">
                Cancel
              </button>
              <button type="submit"
                      class="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                Yes, Delete
              </button>
            </div>
          </form>
        </div>
        
      </div>
    </div>
  </div>


    <!-- QR Section -->
    <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-6">
    
      <div class="bg-white p-6 rounded-xl shadow-sm">
            <h3 class="text-lg font-semibold text-slate-900 mb-4">
                QR Code Preview
            </h3>

            <div id="qr-container" class="w-40 h-40 bg-indigo-50 flex items-center justify-center rounded-lg">
                    <span id="qr-placeholder" class="text-slate-400">Click QR button</span>
                    <img id="qr-image" src="" alt="QR Code" class="hidden w-full h-full object-contain rounded-lg">
                </div>

                <a id="download-btn" href="#" download="qrcode.png"
                class="hidden px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                    Download QR Code
                </a>
                
            </div>
        </div>


        <!-- Stats Section -->
      <div class="bg-white p-6 rounded-xl shadow-sm">
        <h3 class="text-lg font-semibold text-slate-900 mb-4">
            URL Statistics
        </h3>

        <!-- Placeholder -->
        <div id="stats-placeholder" class="text-center py-8 text-slate-400">
          <span class="text-3xl">üìä</span>
          <p class="mt-2 text-sm">Click Stats button to view</p>
        </div>

        <!--this is hidden first-->
        <div id="stats-content" class="hidden space-y-4">
          
          <div class="grid grid-cols-2 gap-4">

            <div class="bg-gradient-to-r from-yellow-300 to-orange-500 rounded-xl p-4 text-white text-center">
              <p class="text-xs opacity-80">Total Clicks</p>
              <p id="stats-clicks" class="text-3xl font-bold" >{{ url.clicks }}</p>
            </div>
            <!-- Status -->
            <div id="stats-status-card" class="rounded-xl p-4 text-center bg-gray-100">
              <p class="text-xs opacity-80">Status</p>
              <p id="stats-status" class="text-xl font-bold">-</p>
            </div>
            
          </div>
          
          <!-- Expiry Date -->
          <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
            <span class="text-2xl">‚è∞</span>
            <div>
              <p class="text-xs text-gray-500">Expiry Date</p>
              <p id="stats-expiry" class="font-semibold text-slate-700">-</p>
            </div>
          </div>
          
        </div>
      </div>



    </div>

  </main>
  

</body>
<!--  JavaScript -->
<script>
function showQR(qrUrl, shortKey) {
    // Get elements
    const qrImage = document.getElementById('qr-image');
    const placeholder = document.getElementById('qr-placeholder');
    const downloadBtn = document.getElementById('download-btn');
    
    // Update QR image
    qrImage.src = qrUrl;
    qrImage.classList.remove('hidden');
    
    // Hide placeholder
    placeholder.classList.add('hidden');
    
    // Update download button
    downloadBtn.href = qrUrl;
    downloadBtn.download = `qrcode-${shortKey}.png`;
    downloadBtn.classList.remove('hidden');
}

//for eidt button
function enableEdit(shortKey) {
    // hide view ,edit
    document.getElementById(`view-${shortKey}`).classList.add('hidden');
    document.getElementById(`edit-${shortKey}`).classList.remove('hidden');
    
    // showing  Save and Cancel
    document.getElementById(`edit-btn-${shortKey}`).classList.add('hidden');
    document.getElementById(`save-btn-${shortKey}`).classList.remove('hidden');
    document.getElementById(`cancel-btn-${shortKey}`).classList.remove('hidden');
    
    document.getElementById(`edit-${shortKey}`).querySelector('input').focus();
}

// cancel the edit
function cancelEdit(shortKey, originalUrl) {
    
    document.getElementById(`edit-${shortKey}`).querySelector('input').value = originalUrl;
    document.getElementById(`view-${shortKey}`).classList.remove('hidden');
    document.getElementById(`edit-${shortKey}`).classList.add('hidden');
    
    // hide Save and  Cancel
    document.getElementById(`edit-btn-${shortKey}`).classList.remove('hidden');
    document.getElementById(`save-btn-${shortKey}`).classList.add('hidden');
    document.getElementById(`cancel-btn-${shortKey}`).classList.add('hidden');
}

// edit save function
function saveEdit(shortKey) {
    const input = document.getElementById(`input-${shortKey}`);
    const newShortKey = input.value.trim();
    const errorEl = document.getElementById(`error-${shortKey}`);
    
    
    document.getElementById(`edit-${shortKey}`).submit();
}

//delete function

function openDeleteModal(shortKey, shortUrl) {
    document.getElementById('delete-url-display').textContent = shortUrl;
    document.getElementById('delete-form').action = `/delete/${shortKey}/`;
    document.getElementById('delete-modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeDeleteModal() {
    document.getElementById('delete-modal').classList.add('hidden');
    document.body.style.overflow = 'auto';
}


// stats showing function
function showStats(clicks, expiryDate, isExpired) {
    // hiding  placeholder showing data
    document.getElementById('stats-placeholder').classList.add('hidden');
    document.getElementById('stats-content').classList.remove('hidden');
    
    document.getElementById('stats-clicks').textContent = clicks;
    document.getElementById('stats-expiry').textContent = expiryDate;

    const statusEl = document.getElementById('stats-status');
    const statusCard = document.getElementById('stats-status-card');
    
    if (expiryDate === 'Never') {
        statusEl.textContent = 'Never';
        statusCard.className = 'rounded-xl p-4 text-center bg-blue-100 text-blue-600';
    } else if (isExpired === 'True') {
        statusEl.textContent = '‚ùå Expired';
        statusCard.className = 'rounded-xl p-4 text-center bg-red-100 text-red-600';
    } else {
        statusEl.textContent = '‚úÖ Active';
        statusCard.className = 'rounded-xl p-4 text-center bg-green-100 text-green-600';
    }
}


</script>

</html>
